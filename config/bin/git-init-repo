#!/usr/bin/env bash
if [ "$#" -eq 1 ]; then
    repo="$1"
elif [ "$#" -eq 2 ]; then
    host="$1"
    repo="$2"
elif [ "$#" -eq 3 ]; then
    host="$1"
    user="$2"
    repo="$3"
else
    echo "error: git init-repo [HOST [USER]] <REPO>"
    exit 1
fi

root="${root:-"$(ghq root || git config --global ghq.root || echo -n "$HOME/.ghq")"}"
host="${host:-"$(git config --global init-repo.defaultHost || echo -n "github.com")"}"
user="${user:-"$(git config --global user.name)"}"

if [ -z "$root" ]; then
    echo 'error: "ghq root" cannot be empty'
    exit 1
elif [ -z "$host" ]; then
    echo 'error: "git config --global init-repo.defaultHost" cannot be empty'
    exit 1
elif [ -z "$user" ]; then
    echo 'error: "git config --global user.name" cannot be empty'
    exit 1
fi

dir="$root/$host/$user/$repo"

if [ -e "$dir" ]; then
    echo "$dir already exists"
    exit 1
fi

mkdir -p "$dir" &&
git -C "$dir" init &&
git -C "$dir" remote add origin "git@$host:$user/$repo.git"
